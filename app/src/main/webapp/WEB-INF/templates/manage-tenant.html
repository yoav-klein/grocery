<!DOCTYPE html>
<html lang="en" dir="ltr">
<head th:include="~{layout :: head(~{::link},~{})}">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" th:href="@{/css/base.css}">
    <link rel="stylesheet" th:href="@{/css/styles.css}">
    <link rel="stylesheet" th:href="@{/css/manage-tenant.css}">
</head>
<body th:replace="~{layout :: layout(~{::main},~{::script})}">
    <main>
        <div>
            <section>
                <div class="members-head">
                    <h2>ðŸ‘¥ Members</h2>
                    <button id="add-invitation-button" th:if="${@tenantUserService.isAdmin(user.id, tenant.id)}">+ Invite</button>
                </div>
                <ul class="member-list">
                    <li class="member-row" th:each="membership: ${memberships}">
                        <img th:src="${membership.user.pictureUrl}" alt="user picture">
                        <p class="flex-1" th:text="${membership.user.name}">John Doe</p>
                        <p class="flex-1" th:text="${membership.user.email}">john.doe@gmail.com</p>
                        <p th:text="${membership.role}">Member</p>
                        <div class="member-action-menu-container-placeholder">
                            <div class="member-action-menu-container" th:unless="${membership.user.id} == ${user.id}" th:if="${@tenantUserService.isAdmin(user.id, tenant.id)}">
                                <button class="kebab"><svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#FFFFFF"><path d="M480-160q-33 0-56.5-23.5T400-240q0-33 23.5-56.5T480-320q33 0 56.5 23.5T560-240q0 33-23.5 56.5T480-160Zm0-240q-33 0-56.5-23.5T400-480q0-33 23.5-56.5T480-560q33 0 56.5 23.5T560-480q0 33-23.5 56.5T480-400Zm0-240q-33 0-56.5-23.5T400-720q0-33 23.5-56.5T480-800q33 0 56.5 23.5T560-720q0 33-23.5 56.5T480-640Z"/></svg></button>
                                <ul class="member-action-menu">
                                    <li>
                                        <form th:unless="${membership.role} == 'admin'" method="post" th:action="@{/tenant/{tenantId}/members/{user}/promote(tenantId=${tenant.id},user=${membership.user.id})}">
                                            <button type="submit">Promote</button>
                                        </form>
                                    </li>
                                    <li>
                                        <form th:if="${@tenantUserService.isStrongerMember(tenant.id, user.id, membership.user.id)}" method="post" th:action="@{/tenant/{tenantId}/members/{user}(tenantId=${tenant.id},user=${membership.user.id})}">
                                            <input type="hidden" name="_method" value="delete">
                                            <button type="submit">Delete</button>
                                        </form>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </li>
                </ul>
            </section>
            <section>
                <h2>Invitations</h2>
                <dialog id="add-invitation-dialog" class="modal-dialog">
                    <h2>Invite new member</h3>
                    <button id="close-modal">X</button>
                    <form class="flex-column" method="post" th:action="@{/tenant/{tenantId}/invitations(tenantId=${tenant.id})}">
                        <div class="inputs flex-column">
                            <div class="field-container">
                                <label for="user-mail">User Email</label>
                                <input id="user-mail" class="long-input" type="text" name="email">
                            </div>
                        </div>
                        <input type="submit" id="submit-button">
                    </form>
                </dialog> 

                <ul th:unless="${#lists.isEmpty(invitations)} == true" class="members-list">
                    <li class="member-row" th:each="invitation : ${invitations}">
                        <img th:src="${invitation.user.pictureUrl}" alt="user picture">
                        <p class="member-name" th:text="${invitation.user.name}"></p>
                        <p class="member-name" th:text="${invitation.user.email}"></p>
                        <div class="member-action-menu-container-placeholder">
                            <div class="member-action-menu-container" th:if="${@tenantUserService.isAdmin(user.id, tenant.id)}">
                                <button class="kebab"><svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#FFFFFF"><path d="M480-160q-33 0-56.5-23.5T400-240q0-33 23.5-56.5T480-320q33 0 56.5 23.5T560-240q0 33-23.5 56.5T480-160Zm0-240q-33 0-56.5-23.5T400-480q0-33 23.5-56.5T480-560q33 0 56.5 23.5T560-480q0 33-23.5 56.5T480-400Zm0-240q-33 0-56.5-23.5T400-720q0-33 23.5-56.5T480-800q33 0 56.5 23.5T560-720q0 33-23.5 56.5T480-640Z"/></svg></button>
                                <ul class="member-action-menu">
                                    <li>
                                        <form th:action="@{/invitations/{invitationId}(invitationId=${invitation.id})}" method="post">
                                            <input type="hidden" name="_method" value="delete">
                                            <button type="submit">Cancel</button>
                                        </form>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </li>
                </ul>
            </section>
        </div>
        <div>
            <section class="danger-zone">
                <ul>
                    <li th:if="${@tenantUserService.isAdmin(user.id, tenant.id)}">
                        <button id="delete-tenant-button" class="danger-zone-button">
                            <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#FFFFFF"><path d="M280-120q-33 0-56.5-23.5T200-200v-520h-40v-80h200v-40h240v40h200v80h-40v520q0 33-23.5 56.5T680-120H280Zm400-600H280v520h400v-520ZM360-280h80v-360h-80v360Zm160 0h80v-360h-80v360ZM280-720v520-520Z"/></svg>
                            <span>Delete Tenant</span>
                        </button>
                        <dialog id="delete-tenant-confirmation-dialog" class="modal-dialog">
                            <p>Are you sure you want to delete this tenant???</p>
                            <form th:action="@{/tenant/{tenantId}(tenantId=${tenant.id})}" method="post">
                                <input type="hidden" name="_method" value="delete">
                                <button type="submit">
                                    Yes
                                </button>
                                <button type="button" class="abort-button">Cancel</button>
                            </form>
                        </dialog>
                    </li>
                    <li>
                        <button id="leave-tenant-button" class="danger-zone-button">
                            <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#FFFFFF"><path d="M120-120v-80h80v-560q0-33 23.5-56.5T280-840h400q33 0 56.5 23.5T760-760v560h80v80H120Zm560-80v-560H280v560h400ZM560-440q17 0 28.5-11.5T600-480q0-17-11.5-28.5T560-520q-17 0-28.5 11.5T520-480q0 17 11.5 28.5T560-440ZM280-760v560-560Z"/></svg>
                            <span>Leave Tenant</span>
                        </button>
                        <dialog id="leave-tenant-confirmation-dialog" class="modal-dialog">
                            <p>Are you sure you want to leave this tenant?</p>
                            <form th:action="@{/tenant/{tenantId}/members/{userId}/leave(tenantId=${tenant.id},userId=${user.id})}" method="post">
                                <input type="hidden" name="_method" value="delete">
                                <button type="submit">
                                    Yes
                                </button>
                                <button type="button" class="abort-button">Cancel</button>
                            </form>
                        </dialog>
                    </li>
                </ul>

            </section>
        </div>
    </main>
    <script th:src="@{/js/manage-tenant.js}"></script>
</body>
</html>